var BnB={levels:[],scale:1,levelBuilderX:8,levelBuilderY:8,levelType:"normal",buildType:"normal",spikeDeath:!1,boundsDeath:!1,fromState:"TitleScreen"};BnB.C={LEVELS_PER_PAGE:100,STANDARD_WIDTH:1536,STANDARD_HEIGHT:2048,WIDTH:640,HEIGHT:900,STRETCH:"width",BOUNDARY_DEATH:!0,ENABLE_LEVEL_NAMES:!0,ENABLE_STARS:!0,SWIPING_OFFSET:!1,SWIPING_LEANING:!0,ENABLE_SCREEN_SHAKE:!0,ENABLE_SEAMLESS_WALLS:!0,TILESIZE:256,OFFSET:.25,SKINNYSIZE:32,HUD_HEIGHT:80,BOTTOM_HUD_HEIGHT:40,BORDER_X:30,HIDE_STARS:!1,VOLUME_SETTINGS:.3,VOLUME_FINISH:.15,DURATION_CROSS_FADE:800,LEVELS_DEMO:["levels/splitlevel_starter.json","levels/startlevel3_v2.json","levels/test_reorientation0_v2.json","levels/fliplevel_v2.json","levels/enemy00.json","levels/wallgatelevel_v2.json","levels/gatelevel.json","levels/test_colors1.json","levels/gates1.json","levels/gatetunnellevel.json","levels/openlevel0_v2.json","levels/test_spike1_v2.json","levels/test_spikedBall0.json","levels/test_movable3.json","levels/test_movable1_v2.json"],LEVELS_NORMAL:["levels/idiot_proof.json","levels/starterB.json","levels/splitlevel.json","levels/rotate_simple.json","levels/test_reorientation0_v2b.json","levels/teamlevel.json","levels/dots_v1.json","levels/test_reorientation3.json","levels/enemy00.json","levels/rotateEnemy.json","levels/enemy02.json","levels/rampage_v3.json","levels/tower_v2.json","levels/wallgatelevel_v2.json","levels/gatelevel.json","levels/gatetunnellevel.json","levels/test_colors1.json","levels/musicalscale.json","levels/openlevel0_v2.json","levels/openLevel02.json","levels/openLevel03.json","levels/tetris_v2.json","levels/switchCenter_v1.json","levels/scatterplot.json","levels/rotatePegs.json","levels/gates1.json","levels/passagelevel.json","levels/pegBridge_v2.json","levels/breakspace.json","levels/test_breakable0.json","levels/test_breakable1.json","levels/test_breakable2.json","levels/switchCracked.json","levels/brokenBridge.json","levels/test_breakable3.json","levels/switchPegs01.json","levels/switchPegs02.json","levels/switchPegs03.json","levels/test_spikedBlock0.json","levels/rotateSpike02.json","levels/test_spike1_v2.json","levels/spikeCrack02.json","levels/greenMover.json","levels/activealien.json","levels/brawnypit.json","levels/test_movable2.json","levels/test_movable3.json","levels/moveBlock01.json","levels/test_movable1_v2.json","levels/test_moveBlock0.json","levels/test_spikedBall0.json","levels/test_spikedBall1.json","levels/test_spikedBall2.json","levels/holycrap.json","levels/superHard.json"],LEVELS_TEST:[]},BnB.SaveData={workingLevel:{},levelStatus:[],init:function(){if(!this.loadGame()){for(var e=0;e<BnB.levels.length;e++)this.levelStatus.push(-1);this.levelStatus[0]=0}},getNumLevels:function(){return this.levelStatus.length},getStars:function(e){return e>=0&&e<this.levelStatus.length?this.levelStatus[e]:-1},setStars:function(e,t){e>=0&&e<this.levelStatus.length&&(this.levelStatus[e]=t,this.saveGame())},unlockAll:function(){for(var e=0;e<this.levelStatus.length;e++)-1==this.levelStatus[e]&&(this.levelStatus[e]=0);this.saveGame()},reset:function(){this.levelStatus=[];for(var e=0;e<BnB.levels.length;e++)this.levelStatus.push(-1);this.levelStatus[0]=0,this.saveGame()},loadGame:function(){var e=localStorage.getItem("BnBLevelData-v1.6.1");return null!=e?(this.levelStatus=JSON.parse(e),!0):!1},saveGame:function(){localStorage.setItem("BnBLevelData-v1.6.1",JSON.stringify(this.levelStatus))}},BnB.Util={goToLevel:function(e){e>=0&&e<BnB.levels.length&&game.state.start("Level",!0,!1,e)},goToCustomLevel:function(e,t){game.state.start("Level",!0,!1,e,t)},handleFiles:function(e){var t=new FileReader;t.onload=BnB.Util.onReaderLoad,t.readAsText(e[0])},onReaderLoad:function(e){BnB.SaveData.workingLevel=JSON.parse(e.target.result),BnB.levelBuilderX=BnB.SaveData.workingLevel.width,BnB.levelBuilderY=BnB.SaveData.workingLevel.height,BnB.SaveData.workingLevel.saved=!0,game.state.start("LevelBuilder")},createMenu:function(e,t){for(var i=game.add.group(),a=game.world.centerX,s=0;s<e.length;s++)i.add(game.add.text(a,0,e[s],t));for(var n=game.world.centerY-i.length*i.getChildAt(0).height/2,s=0;s<i.length;s++){var r=i.getChildAt(s);r.anchor={x:.5,y:.5},r.y=n+s*r.height,r.inputEnabled=!0,r.font="Quicksand"}return i},indexOf2d:function(e,t){return e.reduce(function(e,i,a){var s=i.indexOf(t);return-1!=s&&(e.y=a,e.x=s),e},{x:-1,y:-1})},indexOfAll2d:function(e,t){return e.reduce(function(e,i,a){var s=a;return i.forEach(function(i,a){i===t&&e.push({y:s,x:a})}),e},[])},filter2d:function(e,t,i){for(var a=[],s=0;s<e.length;s++)for(var n=0;n<e[s].length;n++)t.call(i,e[s][n])&&a.push(e[s][n]);return a},directionLookup:{up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}},getDirection:function(e){return e.x<0&&Math.abs(e.x)>=Math.abs(e.y)?"left":e.x>=0&&Math.abs(e.x)>=Math.abs(e.y)?"right":e.y<=0&&Math.abs(e.y)>=Math.abs(e.x)?"up":e.y>0&&Math.abs(e.y)>=Math.abs(e.x)?"down":void 0},pointDist:function(e,t,i){var a;return"up"===e||"down"===e?a="y":("left"===e||"right"===e)&&(a="x"),Math.abs(t[a]-i[a])}},BnB.AudioManager={allowMusic:!0,allowSFX:!0,currentMusic:"gameplayMusic",soundAssets:{gameplayMusic:"sound/BrainBrawnTheme.mp3",menuMusic:"sound/MenuTheme.mp3",star1:"sound/Stage Clear 1 Star.mp3",star2:"sound/Stage Clear 2 Star.mp3",star3:"sound/Stage Clear 3 Star.mp3",ambience1:"sound/Space Ambience 1.ogg",ambience2:"sound/Space Ambience 2.ogg",select:"sound/UI Tap.mp3","next-slide":"sound/UI Continue Tap.mp3","menu-start":"sound/Menu Start Chime.mp3",teleportIn:"sound/Teleport In (Short).mp3",teleportOut:"sound/Teleport Out (Short).mp3",finish:"sound/finish_2.wav",thunk:"sound/Wall Hit (v2).mp3",shatter:"sound/Block Smash.mp3",brainySpace:"sound/Brainy in Space.mp3",brawnySpace:"sound/Brawny in Space.mp3",eaten:"sound/AlienEatingv2.mp3",spikey:"sound/Metal Spike Wall Hit.mp3",switch1:"sound/SwitchHit1.mp3",switch2:"sound/SwitchHit2.mp3",switch3:"sound/SwitchHit3.mp3",switch4:"sound/SwitchHit4.mp3",kill:"sound/Alien Splatted.mp3"},soundBank:{},preload:function(e){for(var t in this.soundAssets)this.soundAssets.hasOwnProperty(t)&&e.load.audio(t,this.soundAssets[t])},toggleMusic:function(){this.allowMusic=!this.allowMusic,this.soundBank.hasOwnProperty(this.currentMusic)&&(this.allowMusic?this.soundBank[this.currentMusic].resume():this.soundBank[this.currentMusic].pause())},toggleSFX:function(){this.allowSFX=!this.allowSFX},createAudioList:function(e){for(var t=0;t<e.length;t++)e[t]!=this.currentMusic&&this.createAudio(e[t])},createAudio:function(e,t){if("undefined"==typeof t&&(t=!1),this.soundAssets.hasOwnProperty(e)){var i=game.add.audio(e,1,t);return this.soundBank[e]=i,!0}return!1},switchToMusic:function(e,t){this.allowMusic&&(this.soundBank.hasOwnProperty(this.currentMusic)&&this.soundBank[this.currentMusic].fadeTo(BnB.DURATION_CROSS_FADE,0),this.currentMusic=e,this.playSound(e,t),this.soundBank[this.currentMusic].volume=0,this.soundBank[this.currentMusic].fadeTo(BnB.DURATION_CROSS_FADE,1))},playMusic:function(e,t){this.allowMusic&&(this.soundBank.hasOwnProperty(this.currentMusic)&&this.soundBank[this.currentMusic].stop(),this.currentMusic=e,this.playSound(e,t))},pauseMusic:function(){this.allowMusic&&this.soundBank.hasOwnProperty(this.currentMusic)&&this.soundBank[this.currentMusic].pause()},resumeMusic:function(){this.allowMusic&&this.soundBank.hasOwnProperty(this.currentMusic)&&this.soundBank[this.currentMusic].resume()},fadeMusicTo:function(e,t){this.allowMusic&&this.soundBank.hasOwnProperty(this.currentMusic)&&this.soundBank[this.currentMusic].fadeTo(e,t)},restoreMusic:function(e){this.allowMusic&&("undefined"==typeof e&&(e=500),this.fadeMusicTo(e,1))},stopSound:function(e){this.soundBank.hasOwnProperty(e)&&this.soundBank[e].stop()},playSFX:function(e,t){this.allowSFX&&this.playSound(e,t)},playSound:function(e,t){"bothSpace"==e?(this.playSound("brainySpace"),this.playSound("brawnySpace")):this.soundBank.hasOwnProperty(e)?this.soundBank[e].play():this.createAudio(e,t)&&this.playSoundDirect(e)},playSoundDirect:function(e){this.soundBank[e].play()}},BnB.GameLogic=function(e){this.gameplayMap=e,this.initializeActiveObjects(),this.debugMode="test"==BnB.buildType,this.debugMode&&this.consoleLogMap()},BnB.GameLogic.prototype.initializeActiveObjects=function(){this.activeObjects=[];for(var e=0;e<this.gameplayMap.height;e++)for(var t=0;t<this.gameplayMap.width;t++){var i=this.gameplayMap.active[e][t];if(" "!=i){var a={type:i,alive:!0,gridPos:{x:t,y:e}};this.activeObjects.push(a)}}},BnB.GameLogic.prototype.mapKeyLookup=function(e,t){var i={checkWin:function(){var e=BnB.Util.indexOf2d(this.gameplayMap.fixed,"G"),t=BnB.Util.indexOf2d(this.gameplayMap.active,"B");return t.x==e.x&&t.y==e.y?"missionSuccess":void 0},unlockGates:function(e,t,i,a){return function(s){this.gameplayMap.fixed[s.y][s.x]=e,BnB.Util.indexOfAll2d(this.gameplayMap.fixed,t).forEach(function(e){this.gameplayMap.fixed[e.y][e.x]=i},this),BnB.Util.indexOfAll2d(this.gameplayMap.fixed,a).forEach(function(e){this.gameplayMap.fixed[e.y][e.x]=" "},this)}},killFixed:function(e){this.gameplayMap.fixed[e.y][e.x]=" "},killActive:function(e){return function(){return e}},killActiveDirectional:function(e,i){return e==t?function(){return i}:void 0}},a={" ":{b:{isSolid:!1},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},n:{b:{isSolid:!1},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},"#":{b:{isSolid:!0},B:{isSolid:!0},"@":{isSolid:!0},$:{isSolid:!0},m:{isSolid:!0}},".":{b:{isSolid:!1,trigger:i.killActive("space")},B:{isSolid:!1,trigger:i.killActive("space")},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},E:{b:{isSolid:!1,trigger:i.killActive("eaten")},B:{isSolid:!1,trigger:i.killFixed},"@":{isSolid:!0},$:{isSolid:!1,trigger:i.killFixed},m:{isSolid:!0}},g:{b:{isSolid:!1,trigger:i.checkWin},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},G:{b:{isSolid:!1},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},0:{b:{isSolid:!1},B:{isSolid:!0},"@":{isSolid:!0},$:{isSolid:!0},m:{isSolid:!0}},1:{b:{isSolid:!1,trigger:i.unlockGates("2","3","4","17")},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},2:{b:{isSolid:!1},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},3:{b:{isSolid:!0},B:{isSolid:!0},"@":{isSolid:!0},$:{isSolid:!0},m:{isSolid:!0}},4:{b:{isSolid:!1},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},5:{b:{isSolid:!1,trigger:i.unlockGates("6","7","8","18")},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},6:{b:{isSolid:!1},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},7:{b:{isSolid:!0},B:{isSolid:!0},"@":{isSolid:!0},$:{isSolid:!0},m:{isSolid:!0}},8:{b:{isSolid:!1},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},9:{b:{isSolid:!1,trigger:i.unlockGates("10","11","12","19")},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},10:{b:{isSolid:!1},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},11:{b:{isSolid:!0},B:{isSolid:!0},"@":{isSolid:!0},$:{isSolid:!0},m:{isSolid:!0}},12:{b:{isSolid:!1},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},13:{b:{isSolid:!1,trigger:i.unlockGates("14","15","16","20")},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},14:{b:{isSolid:!1},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},15:{b:{isSolid:!0},B:{isSolid:!0},"@":{isSolid:!0},$:{isSolid:!0},m:{isSolid:!0}},16:{b:{isSolid:!1},B:{isSolid:!1},"@":{isSolid:!1},$:{isSolid:!1},m:{isSolid:!1}},17:{b:{isSolid:!1},B:{isSolid:!0},"@":{isSolid:!0},$:{isSolid:!0},m:{isSolid:!0}},18:{b:{isSolid:!1},B:{isSolid:!0},"@":{isSolid:!0},$:{isSolid:!0},m:{isSolid:!0}},19:{b:{isSolid:!1},B:{isSolid:!0},"@":{isSolid:!0},$:{isSolid:!0},m:{isSolid:!0}},20:{b:{isSolid:!1},B:{isSolid:!0},"@":{isSolid:!0},$:{isSolid:!0},m:{isSolid:!0}},X:{b:{isSolid:!1,trigger:i.killActive("spikey")},B:{isSolid:!1,trigger:i.killActive("spikey")},"@":{isSolid:!0},$:{isSolid:!0},m:{isSolid:!0}},"+":{b:{isSolid:!0},B:{isSolid:!1,trigger:i.killFixed},"@":{isSolid:!0},$:{isSolid:!1,trigger:i.killFixed},m:{isSolid:!0}}};return a[e]},BnB.GameLogic.prototype.consoleLogMap=function(){for(var e=[],t=0;t<this.gameplayMap.height;t++){e[t]=""+t+"|";for(var i=0;i<this.gameplayMap.width;i++)e[t]+=" "!=this.gameplayMap.active[t][i]?this.gameplayMap.active[t][i]:this.gameplayMap.fixed[t][i]}return e.forEach(function(e){console.log(e)}),!0},BnB.GameLogic.prototype.gravitySwitch=function(e){this.gameStateChanges={activeChanges:[],gravity:e,endState:"none",moveSuccess:!1},this.populateActiveChanges();for(var t={moveSuccess:!0};t.moveSuccess===!0;)t=this.stepOnce(e),t.moveSuccess&&(this.gameStateChanges.moveSuccess=!0);for(var i=0;i<this.activeObjects.length;i++){var a=this.activeObjects[i];-1!=a.gridPos.x&&-1!=a.gridPos.y&&this.gameStateChanges.activeChanges[i].push(a.gridPos)}return this.debugMode&&(console.log(this.gameStateChanges),console.log(e),this.consoleLogMap()),this.gameStateChanges},BnB.GameLogic.prototype.populateActiveChanges=function(){for(var e=0;e<this.activeObjects.length;e++){var t=[];t.push(this.activeObjects[e].gridPos),this.gameStateChanges.activeChanges.push(t)}},BnB.GameLogic.prototype.stepOnce=function(e){var t=!1,i={};if("up"===e||"left"===e)for(var a=0;a<this.gameplayMap.height;a++)for(var s=0;s<this.gameplayMap.width;s++)this.attemptMove(e,s,a)&&(t=!0);else if("down"===e||"right"===e)for(var a=this.gameplayMap.height-1;a>=0;a--)for(var s=this.gameplayMap.width-1;s>=0;s--)this.attemptMove(e,s,a)&&(t=!0);return this.checkFixedTriggers(e,i),i.moveSuccess=t,i},BnB.GameLogic.prototype.attemptMove=function(e,t,i){var a=this.gameplayMap.active[i][t];if(" "==a)return!1;var s=this.getActiveObjectAtGridPos(t,i);if(-1==s)return!1;var n={x:BnB.Util.directionLookup[e].x+t,y:BnB.Util.directionLookup[e].y+i};return this.isPositionClear(a,s,n.x,n.y)?(this.gameplayMap.active[i][t]=" ",this.gameplayMap.active[n.y][n.x]=a,this.activeObjects[s].gridPos=n,!0):!1},BnB.GameLogic.prototype.isPositionClear=function(e,t,i,a){if(0>i||0>a||i>=this.gameplayMap.width||a>=this.gameplayMap.height){if(BnB.C.BOUNDARY_DEATH){var s=this.gameStateChanges.endState;"none"==s?"b"==e?this.gameStateChanges.endState="brainySpace":"B"==e&&(this.gameStateChanges.endState="brawnySpace"):("brawnySpace"==s||"brainySpace"==s)&&(this.gameStateChanges.endState="bothSpace")}return!1}return this.mapKeyLookup(this.gameplayMap.fixed[a][i])[e].isSolid===!0?!1:" "!=this.gameplayMap.active[a][i]?this.checkActiveTriggers(e,t,this.gameplayMap.active[a][i],i,a):!0},BnB.GameLogic.prototype.checkActiveTriggers=function(e,t,i,a,s){if(!("$"!=e&&"$"!=i||"b"!=e&&"b"!=i&&"B"!=e&&"B"!=i))return"none"===this.gameStateChanges.endState&&(this.gameStateChanges.endState="spikey"),!0;if("m"==e||"m"==i){if("b"==e||"b"==i)return"none"===this.gameStateChanges.endState&&(this.gameStateChanges.endState="eaten"),!0;if("B"==e||"$"==e){var n=this.getActiveObjectAtGridPos(a,s);return this.gameStateChanges.activeChanges[n].push({x:a,y:s}),this.killActiveObj(n),this.gameStateChanges.activeChanges[t].push({x:a,y:s,eventType:i,killTarget:n,fired:!1}),!0}if("B"==i||"$"==i)return this.gameStateChanges.activeChanges[t].push({x:a,y:s,eventType:i,killTarget:t,fired:!1}),this.gameStateChanges.activeChanges[t].push({x:a,y:s}),this.killActiveObj(t),!1}return!1},BnB.GameLogic.prototype.checkFixedTriggers=function(e){for(var t=0;t<this.activeObjects.length;t++){var i=this.activeObjects[t];if(i.alive){var a=i.gridPos.x,s=i.gridPos.y,n=this.gameplayMap.fixed[s][a],r=this.mapKeyLookup(n,e)[i.type].trigger;if("function"==typeof r){results=r.call(this,{x:a,y:s}),"string"==typeof results&&"none"===this.gameStateChanges.endState&&(this.gameStateChanges.endState=results);var o={x:a,y:s,eventType:n,fired:!1};this.gameStateChanges.activeChanges[t].push(o)}}}},BnB.GameLogic.prototype.getActiveObjectAtGridPos=function(e,t){for(var i=0;i<this.activeObjects.length;i++){var a=this.activeObjects[i];if(a.alive&&a.gridPos.x==e&&a.gridPos.y==t)return i}return-1},BnB.GameLogic.prototype.killActiveObj=function(e){if(e>=0&&e<this.activeObjects.length){var t=this.activeObjects[e];t.alive=!1,this.gameplayMap.active[t.gridPos.y][t.gridPos.x]=" ",t.gridPos={x:-1,y:-1}}},BnB.GraphicsManager=function(e){this.activeObjs=[],this.fixed=[],this.isFinished=!0,this.missionSuccess=!1,this.gridWidth=e.width,this.gridHeight=e.height,this.starLayer=game.add.group(),this.floorGroup=game.add.group(),this.floor2Group=game.add.group(),this.mainGroup=game.add.group(),this.mainGroup.enableBody=!0,this.convertValues=this.getConvertValues(),BnB.C.ENABLE_STARS&&this.starGenerator(),this.initializeSprites(e),this.animationCounter=0,this.gravityDirection},BnB.GraphicsManager.prototype.graphicsKeyLookup=function(e){var t={killSelf:function(e){var t=this.fixed[e.y][e.x];"E"==t.type||"m"==t.type?BnB.AudioManager.playSFX("kill"):"+"==t.type&&BnB.AudioManager.playSFX("shatter"),t.sprite.destroy()},killActiveTarget:function(e){BnB.AudioManager.playSFX("kill"),this.activeObjs[e].alive=!1,this.activeObjs[e].sprite.visible=!1},switchTo:function(e){return function(t){this.fixed[t.y][t.x].sprite.frameName=this.graphicsKeyLookup(e).image}},switchAll:function(e,t){var i={type:e,typeTo:t};return function(){for(var e=BnB.Util.filter2d(this.fixed,function(e){return e.type===this.type?!0:void 0},i),a=0;a<e.length;a++)e[a].sprite.frameName=this.graphicsKeyLookup(t).image}},switchBoth:function(e,t,i,a){var s={type:t,typeTo:i,typePeg:a};return function(t){"2"==e?BnB.AudioManager.playSFX("switch1"):"6"==e?BnB.AudioManager.playSFX("switch2"):"10"==e?BnB.AudioManager.playSFX("switch3"):"14"==e&&BnB.AudioManager.playSFX("switch4"),this.fixed[t.y][t.x].sprite.frameName=this.graphicsKeyLookup(e).image;for(var a=BnB.Util.filter2d(this.fixed,function(e){return e.type===this.type?!0:void 0},s),n=0;n<a.length;n++)a[n].sprite.frameName=this.graphicsKeyLookup(i).image;for(var r=BnB.Util.filter2d(this.fixed,function(e){return e.type===this.typePeg?!0:void 0},s),n=r.length-1;n>=0;n--)r[n].sprite.destroy()}}},i={b:{order:2,image:"SpriteSheet0074",b:{},B:{},$:t.killActiveTarget},B:{order:4,image:"SpriteSheet0074",b:{},B:{},m:t.killActiveTarget,$:t.killActiveTarget},m:{order:3,image:"brainandbrawn_alienA_move",b:{},B:t.killActiveTarget,$:t.killActiveTarget},"@":{order:3,image:"brainandbrawn_slidingBlock",b:{},B:{}},$:{order:0,image:"brainandbrawn_alienB_move",b:{},B:{},m:t.killActiveTarget}," ":{b:{},B:{}},n:{b:{},B:{}},"#":{order:0,image:"brainandbrawn_block",b:{},B:{}},".":{order:0,b:{},B:{}},E:{order:3,image:"brainandbrawn_alien-b",b:{},B:t.killSelf,$:t.killSelf},g:{order:0,image:"brainandbrawn_goalBrainyB",b:{},B:{}},G:{order:0,image:"brainandbrawn_goalBrawnyB",b:{},B:{}},0:{order:0,image:"brainandbrawn_pipe0",b:{},B:{}},1:{onFloor:!0,order:0,image:"brainandbrawn_switchNew1A",b:t.switchBoth("2","3","4","17"),B:{}},2:{order:0,image:"brainandbrawn_switchNew1B",b:{},B:{}},3:{order:0,image:"brainandbrawn_gateNew1C",b:{},B:{}},4:{onFloor:!0,order:0,image:"brainandbrawn_gateNew1D",b:{},B:{}},5:{onFloor:!0,order:0,image:"brainandbrawn_switchNew2A",b:t.switchBoth("6","7","8","18"),B:{}},6:{order:0,image:"brainandbrawn_switchNew2B",b:{},B:{}},7:{order:0,image:"brainandbrawn_gateNew2C",b:{},B:{}},8:{onFloor:!0,order:0,image:"brainandbrawn_gateNew2D",b:{},B:{}},9:{onFloor:!0,order:0,image:"brainandbrawn_switchNew3A",b:t.switchBoth("10","11","12","19"),B:{}},10:{order:0,image:"brainandbrawn_switchNew3B",b:{},B:{}},11:{order:0,image:"brainandbrawn_gateNew3C",b:{},B:{}},12:{onFloor:!0,order:0,image:"brainandbrawn_gateNew3D",b:{},B:{}},13:{onFloor:!0,order:0,image:"brainandbrawn_switchNew4A",b:t.switchBoth("14","15","16","20"),B:{}},14:{order:0,image:"brainandbrawn_switchNew4B",b:{},B:{}},15:{order:0,image:"brainandbrawn_gateNew4C",b:{},B:{}},16:{onFloor:!0,order:0,image:"brainandbrawn_gateNew4D",b:{},B:{}},17:{order:0,image:"brainandbrawn_peg1",b:{},B:{}},18:{order:0,image:"brainandbrawn_peg2",b:{},B:{}},19:{order:0,image:"brainandbrawn_peg3",b:{},B:{}},20:{order:0,image:"brainandbrawn_peg4",b:{},B:{}},X:{order:0,image:"brainandbrawn_alienB",b:{},B:{}},"+":{order:0,image:"brainandbrawn_wallDamaged",b:{},B:t.killSelf,$:t.killSelf}};return i[e]},BnB.GraphicsManager.prototype.initializeSprites=function(e){for(var t=0;t<e.height;t++){this.fixed[t]=[];for(var i=0;i<e.width;i++){var a=e.active[t][i],s=this.gridToPixel({x:i,y:t});if("n"!=e.fixed[t][i]){var n=game.add.sprite(s.x,s.y,"spritesheet","brainandbrawn_floor");this.floorGroup.add(n),n.anchor={x:.5,y:.5},n.scale.setTo(this.convertValues.spriteScale,this.convertValues.spriteScale)}if(" "!=a){var r;r="b"===a?"brainy_SpriteSheet":"B"===a?"brawny_SpriteSheet":"spritesheet";var o=game.add.sprite(s.x,s.y,r,this.graphicsKeyLookup(a).image);o.scale.setTo(this.convertValues.spriteScale,this.convertValues.spriteScale),o.anchor={x:.5,y:.5},o.customZ=this.getZFromGridY(a,t),o.priority=!0,this.mainGroup.add(o),this.activeObjs.push({type:a,alive:!0,sprite:o}),("b"===a||"B"===a)&&(o.animations.add("moveRight",Phaser.Animation.generateFrameNames("SpriteSheet",0,10,"",4),24,!1,!1),o.animations.add("moveDown",Phaser.Animation.generateFrameNames("SpriteSheet",10,20,"",4),24,!1,!1),o.animations.add("moveUp",Phaser.Animation.generateFrameNames("SpriteSheet",20,30,"",4),24,!1,!1),o.animations.add("beamIn",Phaser.Animation.generateFrameNames("SpriteSheet",74,69,"",4),24,!1,!1),o.animations.add("beamOut",Phaser.Animation.generateFrameNames("SpriteSheet",69,74,"",4),24,!1,!1),o.animations.play("beamIn"),BnB.AudioManager.playSFX("teleportIn"))}this.fixed[t][i]={type:e.fixed[t][i]};var h=this.graphicsKeyLookup(e.fixed[t][i]);if("string"==typeof h.image){var l="spritesheet";BnB.C.ENABLE_SEAMLESS_WALLS&&"brainandbrawn_block"==h.image&&(l="block_SpriteSheet",h.image=this.getWallImage(e.fixed,i,t)),this.fixed[t][i].sprite=game.add.sprite(s.x,s.y,l,h.image),this.fixed[t][i].sprite.scale.setTo(this.convertValues.spriteScale,this.convertValues.spriteScale),this.fixed[t][i].sprite.anchor={x:.5,y:.5},this.fixed[t][i].sprite.customZ=this.getZFromGridY(e.fixed[t][i],t),this.fixed[t][i].sprite.priority=!1,h.hasOwnProperty("onFloor")?this.floor2Group.add(this.fixed[t][i].sprite):this.mainGroup.add(this.fixed[t][i].sprite)}}}},BnB.GraphicsManager.prototype.getConvertValues=function(){var e={w:BnB.C.WIDTH-2*BnB.C.BORDER_X,h:game.height-BnB.C.HUD_HEIGHT-BnB.C.BOTTOM_HUD_HEIGHT},t=e.w/e.h,i=(this.gridWidth+.5)/(this.gridHeight+.5);return t>i?(e.fitType="height",e.scaledTileSize=e.h/this.gridHeight):(e.fitType="width",e.scaledTileSize=e.w/this.gridWidth),e.spriteScale=Math.ceil(e.scaledTileSize)/BnB.C.TILESIZE,e.scaledTileSize=Math.floor(e.scaledTileSize),e.borderX=(e.w-this.gridWidth*e.scaledTileSize)/2+BnB.C.BORDER_X,e.borderY=(e.h-this.gridHeight*e.scaledTileSize)/2+BnB.C.HUD_HEIGHT,e},BnB.GraphicsManager.prototype.gridToPixel=function(e){return{x:Math.round(this.convertValues.borderX+(e.x+.5)*this.convertValues.scaledTileSize),y:Math.round(this.convertValues.borderY+(e.y+.5)*this.convertValues.scaledTileSize)}},BnB.GraphicsManager.prototype.pixelToGrid=function(e){return{x:Math.floor((e.x-this.convertValues.borderX)/this.convertValues.scaledTileSize),y:Math.floor((e.y-this.convertValues.borderY)/this.convertValues.scaledTileSize)}},BnB.GraphicsManager.prototype.setActiveOffset=function(e,t){var i=.5,a=.5;"left"===e||"right"===e?i=.5-.25*t:("up"===e||"down"===e)&&(a=.5-.25*t);for(element in this.activeObjs)this.activeObjs[element].sprite.anchor={x:i,y:a}},BnB.GraphicsManager.prototype.updateGraphics=function(e){this.gravityDirection=e.gravity,"down"!=this.gravityDirection?this.sortMainZ(e,!1):this.sortMainZ(e,!0),"missionSuccess"===e.endState&&(this.missionSuccess=!0);for(var t=function(e,t,i){return function(){for(var a=this.pixelToGrid({x:this.activeObjs[t].sprite.x,y:this.activeObjs[t].sprite.y}),s=1;s<e.length-1;s++){var n=e[s];if(n.hasOwnProperty("fired")&&!n.fired&&("left"==this.gravityDirection&&a.x<=n.x||"right"==this.gravityDirection&&a.x>=n.x||"up"==this.gravityDirection&&a.y<=n.y||"down"==this.gravityDirection&&a.y>=n.y)){n.fired=!0;var r=this.graphicsKeyLookup(e[s].eventType)[i];"function"==typeof r&&(results="undefined"!=typeof e[s].killTarget?r.call(this,e[s].killTarget):r.call(this,{x:n.x,y:n.y}))}}}},i=0;i<this.activeObjs.length;i++)if(this.activeObjs[i].alive){var a=this.activeObjs[i].sprite,s=this.activeObjs[i].type,n=e.activeChanges[i],r=n[n.length-1],o=this.gridToPixel(r),h=BnB.Util.pointDist(e.gravity,n[0],r);if(recenter=game.add.tween(a.anchor),recenter.to({x:.5,y:.5},250,Phaser.Easing.Sinusoidal.In,!0),h>0){this.isFinished=!1;var l=game.add.tween(a);l.to({x:o.x,y:o.y},180,Phaser.Easing.Sinusoidal.In,!0),("b"===s||"B"===s)&&(a.x-o.x<0?(a.scale.x=Math.abs(a.scale.x),a.animations.play("moveRight")):a.x-o.x>0?(a.scale.x=-1*Math.abs(a.scale.x),a.animations.play("moveRight")):a.y-o.y<0?a.animations.play("moveDown"):a.y-o.y>0&&a.animations.play("moveUp")),this.animationCounter+=1;var d=t(n,i,s);l.onComplete.add(function(e){return function(){e.call(this),this.animationCounter-=1}}(d),this),l.onUpdateCallback(d,this)}else a.animations.play("leanReset")}},BnB.GraphicsManager.prototype.refresh=function(){BnB.C.ENABLE_STARS&&this.starUpdate(this.gravityDirection)},BnB.GraphicsManager.prototype.sortMainZ=function(e,t){for(var i=0;i<this.activeObjs.length;i++){var a,s=this.activeObjs[i];if(t){var n=e.activeChanges[i];a=n[n.length-1].y}else a=this.pixelToGrid(s.sprite.position).y;var r=this.getZFromGridY(s.type,a);s.sprite.customZ=r}this.mainGroup.sort("customZ",Phaser.Group.SORT_ASCENDING)},BnB.GraphicsManager.prototype.getZFromGridY=function(e,t){return 10*t+this.graphicsKeyLookup(e).order},BnB.GraphicsManager.prototype.areAnimationsFinished=function(){if(0!==this.animationCounter)return!1;if(this.isFinished)return this.gravityFinished=void 0,!0;if(BnB.C.ENABLE_SCREEN_SHAKE&&this.screenShake(this.gravityDirection),this.isFinished=!0,this.missionSuccess)for(var e=0;e<this.activeObjs.length;e++)this.activeObjs[e].alive&&("b"===this.activeObjs[e].type||"B"===this.activeObjs[e].type)&&(this.animationCounter+=1,this.activeObjs[e].sprite.animations.getAnimation("beamOut").onComplete.add(function(){this.animationCounter-=1},this),this.activeObjs[e].sprite.animations.play("beamOut"),BnB.AudioManager.playSFX("teleportOut"))},BnB.GraphicsManager.prototype.screenShake=function(e){var t;if("up"===e)t={x:0,y:-1};else if("down"===e)t={x:0,y:1};else if("left"===e)t={x:-1,y:0};else{if("right"!==e)return!1;t={x:1,y:0}}this.mainGroup.x+=t.x,this.mainGroup.y+=t.y,this.floorGroup.x+=t.x,this.floorGroup.y+=t.y,this.floor2Group.x+=t.x,this.floor2Group.y+=t.y;var i=function(e){return function(){this.mainGroup.x-=e.x,this.mainGroup.y-=e.y,this.floorGroup.x-=e.x,this.floorGroup.y-=e.y,this.floor2Group.x-=e.x,this.floor2Group.y-=e.y}}(t).bind(this);return setTimeout(i,32),!0},BnB.GraphicsManager.prototype.starGenerator=function(){this.spaceC=game.add.tileSprite(0,0,game.width,game.height,"spaceC"),this.spaceB=game.add.tileSprite(0,0,game.width,game.height,"spaceB"),this.spaceA=game.add.tileSprite(0,0,game.width,game.height,"spaceA"),this.starLayer.add(this.spaceC),this.starLayer.add(this.spaceB),this.starLayer.add(this.spaceA)},BnB.GraphicsManager.prototype.starUpdate=function(e){"undefined"==typeof e&&(e="down");var t=BnB.Util.directionLookup[e];this.spaceC.tilePosition.x+=t.x,this.spaceC.tilePosition.y+=t.y,this.spaceB.tilePosition.x+=2*t.x,this.spaceB.tilePosition.y+=2*t.y,this.spaceA.tilePosition.x+=4*t.x,this.spaceA.tilePosition.y+=4*t.y},BnB.GraphicsManager.prototype.setLeaning=function(e,t){t=Math.abs(10*t),0===t&&(t=1);var i=1-t/Math.pow(t,2);0>i&&(i=0);for(var a,s,n=0;n<this.activeObjs.length;n++)this.activeObjs[n].alive&&(a=this.activeObjs[n].sprite,s=this.activeObjs[n].type,("b"===s||"B"===s)&&("right"===e?(a.scale.x=Math.abs(a.scale.x),a.animations.frame=30+Math.floor(12*i),a.animations.add("leanReset",Phaser.Animation.generateFrameNames("SpriteSheet",30+Math.floor(12*i),30,"",4),24,!1,!1)):"left"===e?(a.scale.x=-1*Math.abs(a.scale.x),a.animations.frame=30+Math.floor(12*i),a.animations.add("leanReset",Phaser.Animation.generateFrameNames("SpriteSheet",30+Math.floor(12*i),30,"",4),24,!1,!1)):"down"===e?(a.animations.frame=43+Math.floor(12*i),a.animations.add("leanReset",Phaser.Animation.generateFrameNames("SpriteSheet",43+Math.floor(12*i),43,"",4),24,!1,!1)):"up"===e&&(a.animations.frame=56+Math.floor(12*i),a.animations.add("leanReset",Phaser.Animation.generateFrameNames("SpriteSheet",56+Math.floor(12*i),56,"",4),24,!1,!1))))},BnB.GraphicsManager.prototype.resetLeaning=function(){for(var e=0;e<this.activeObjs.length;e++)this.activeObjs[e].alive&&("b"===this.activeObjs[e].type||"B"===this.activeObjs[e].type)&&this.activeObjs[e].sprite.animations.play("leanReset")},BnB.GraphicsManager.prototype.getWallImage=function(e,t,i){var a=i-1>=0;a&&(a="#"==e[i-1][t]);var s=i+1<this.gridHeight;s&&(s="#"==e[i+1][t]);var n=t-1>=0;n&&(n="#"==e[i][t-1]);var r=t+1<this.gridWidth;r&&(r="#"==e[i][t+1]);var o="brainandbrawn_wall_"+a.toString()+"_"+s.toString()+"_"+n.toString()+"_"+r.toString();return o},BnB.InputManager=function(e){this.state=e,this.direction="none",this.cursors=game.input.keyboard.createCursorKeys(),this.cursors.left.onDown.add(this.setDirection("left"),this),this.cursors.right.onDown.add(this.setDirection("right"),this),this.cursors.up.onDown.add(this.setDirection("up"),this),this.cursors.down.onDown.add(this.setDirection("down"),this),this.startPoint={},game.input.onDown.add(function(e){"ready"===this.state&&(this.startPoint.x=e.clientX,this.startPoint.y=e.clientY,(BnB.C.SWIPING_OFFSET||BnB.C.SWIPING_LEANING)&&(this.state="swiping"))},this),game.input.onUp.add(function(e){this._isSwipeGood(this.startPoint,{x:e.clientX,y:e.clientY})},this)},BnB.InputManager.prototype={setDirection:function(e){return function(){("ready"==this.state||"swiping"==this.state)&&(this.direction=e,this.state="moving")}},_isSwipeGood:function(e,t){var i={x:t.x-e.x,y:t.y-e.y};if(Math.abs(i.x)>15||Math.abs(i.y)>15){if(i.x<0&&Math.abs(i.x)>Math.abs(i.y))return this.setDirection("left").call(this),!0;if(i.x>0&&Math.abs(i.x)>Math.abs(i.y))return this.setDirection("right").call(this),!0;if(i.y<0&&Math.abs(i.y)>Math.abs(i.x))return this.setDirection("up").call(this),!0;if(i.y>0&&Math.abs(i.y)>Math.abs(i.x))return this.setDirection("down").call(this),!0;this.onUpCallback()}return this.state="ready",!1},getSwipingOffset:function(){return{x:(game.input.activePointer.clientX-this.startPoint.x)/BnB.C.WIDTH,y:(game.input.activePointer.clientY-this.startPoint.y)/BnB.C.WIDTH}},onUpCallback:function(){}},BnB.AdjustMenu=function(){},BnB.AdjustMenu.prototype={create:function(){var e=BnB.C.WIDTH,t=(BnB.C.HEIGHT,{font:"80px Quicksand",fill:"#ffffff",align:"center"});this.widthText=this.add.text(e/2,200,BnB.levelBuilderX,t),this.widthText.anchor.setTo(.5),this.heightText=this.add.text(e/2,615,BnB.levelBuilderY,t),this.heightText.anchor.setTo(.5);var i=this.add.image(e/2-150,200,"arrow");i.inputEnabled=!0,i.anchor.setTo(.5),i.events.onInputDown.add(this.onDownX,this);var a=this.add.image(e/2+150,200,"arrow");a.inputEnabled=!0,a.events.onInputDown.add(this.onUpX,this),a.anchor.setTo(.5),a.rotation=Math.PI;var s=this.add.image(e/2,480,"arrow");s.inputEnabled=!0,s.events.onInputDown.add(this.onUpY,this),s.anchor.setTo(.5),s.rotation=Math.PI/2;var n=this.add.image(e/2,750,"arrow");n.inputEnabled=!0,n.events.onInputDown.add(this.onDownY,this),n.anchor.setTo(.5),n.rotation=3*Math.PI/2,t={font:"30px Quicksand",fill:"#ffffff",align:"center"},this.boundsText=this.add.text(300,0,"Boundary Death: "+BnB.C.BOUNDARY_DEATH,t),this.boundsText.inputEnabled=!0,this.boundsText.events.onInputDown.add(this.toggleBounds,this);var r=this.add.image(10,10,"backArrow");r.scale.setTo(.5),r.inputEnabled=!0,r.events.onInputDown.add(this.onBack,this)},onUpX:function(){BnB.levelBuilderX<10&&(BnB.levelBuilderX++,this.widthText.text=BnB.levelBuilderX)},onDownX:function(){BnB.levelBuilderX>3&&(BnB.levelBuilderX--,this.widthText.text=BnB.levelBuilderX)
},onUpY:function(){BnB.levelBuilderY<16&&(BnB.levelBuilderY++,this.heightText.text=BnB.levelBuilderY)},onDownY:function(){BnB.levelBuilderY>3&&(BnB.levelBuilderY--,this.heightText.text=BnB.levelBuilderY)},toggleBounds:function(){BnB.C.BOUNDARY_DEATH=!BnB.C.BOUNDARY_DEATH,this.boundsText.text="Boundary Death: "+BnB.C.BOUNDARY_DEATH},onBack:function(){this.state.start("LevelBuilder")}},BnB.Boot=function(){},BnB.Boot.prototype={init:function(){BnB.scale=BnB.C.WIDTH/BnB.C.STANDARD_WIDTH,BnB.levels="demo"==BnB.buildType?BnB.C.LEVELS_DEMO:BnB.C.LEVELS_NORMAL,BnB.SaveData.init(),this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.kineticScrolling=this.game.plugins.add(Phaser.Plugin.KineticScrolling),game.kineticScrolling.configure({kineticMovement:!1,timeConstantScroll:325,horizontalScroll:!1,verticalScroll:!0,horizontalWheel:!1,verticalWheel:!0,deltaWheel:40})},preload:function(){this.load.image("loadingBar","images/loadingBar.png"),this.load.image("loadingBack","images/loadingBarBack.png")},create:function(){game.state.start("Preloader")}},BnB.Level=function(){},BnB.Level.prototype={init:function(e,t){this.level=e,"undefined"!=typeof t&&(this.levelData=t)},create:function(){BnB.AudioManager.createAudioList(["teleportIn","teleportOut","thunk","shatter","brainySpace","brawnySpace","eaten","spikey","switch1","switch2","switch3","switch4","kill","star1","star2","star3"]),"normal"==BnB.levelType&&(this.levelData=JSON.parse(game.cache.getText("level"+this.level))),this.gridWidth=this.levelData.width,this.gridHeight=this.levelData.length,this.tutorialFinished=!1,this.levelFinished=!1,this.numMoves=0,this.currentStarLevel=3,this.starLevels=[20,10],"undefined"!=typeof this.levelData.starLevels&&2==this.levelData.starLevels.length&&(this.starLevels=this.levelData.starLevels),this.gameLogic=new BnB.GameLogic(this.levelData),this.graphicsManager=new BnB.GraphicsManager(this.levelData),this.inputManager=new BnB.InputManager("waiting"),this.inputManager.onUpCallback=this.graphicsManager.resetLeaning.bind(this.graphicsManager),this.setUpHUD(),this.initializeScreens(),"builder"==BnB.levelType&&this.enableBuilderMode(),"undefined"!=typeof this.levelData.tutorial?(this.currentTutorial=0,this.startTutorial()):(this.tutorialFinished=!0,this.inputManager.state="ready"),this.prevKey=game.input.keyboard.addKey(Phaser.Keyboard.P),this.prevKey.onUp.add(this.previousLevel,this),this.nextKey=game.input.keyboard.addKey(Phaser.Keyboard.N),this.nextKey.onUp.add(this.skipLevel,this),this.restartKey=game.input.keyboard.addKey(Phaser.Keyboard.R),this.restartKey.onUp.add(function(){this.forceRestart()},this),"LevelSelect"==BnB.fromState?(BnB.AudioManager.switchToMusic("gameplayMusic",!0),this.game.world.setBounds(0,0,this.game.width,this.game.height)):BnB.AudioManager.restoreMusic(),BnB.fromState="Level"},setUpHUD:function(){var e="";"test"==BnB.buildType&&"test"!=this.levelData.name&&"Exported Level"!=this.levelData.name&&(e=": "+this.levelData.name),this.moveText=this.add.text(150,15,"Moves: 0",{font:"25px Quicksand",fontSize:25,fill:"#ffffff",align:"left"}),BnB.C.ENABLE_LEVEL_NAMES&&(this.levelText=this.add.text(game.width/2,game.height,"Level "+(this.level+1)+e,{font:"18px Quicksand",fill:"#ffffff",align:"left"}),this.levelText.anchor={x:.5,y:1}),this.restartButton=this.add.image(570,2,"rButton"),this.restartButtonBig=this.add.image(580,50,"rButton"),this.restartButtonBig.anchor={x:.5,y:.5},this.restartButtonBig.scale.setTo(2.5,2.5),this.restartButtonBig.inputEnabled=!0,this.restartButtonBig.events.onInputDown.add(this.forceRestart,this),this.restartButtonBig.alpha=0,this.settingsButton=this.add.image(0,0,"mButton"),this.settingsButton.scale.setTo(.25),this.settingsButton.inputEnabled=!0,this.settingsButton.events.onInputDown.add(this.showSettings,this),this.starsHUD=this.add.group(),this.updateStars(3)},initializeScreens:function(){var e={font:"36px Quicksand",fill:"#ffffff"};this.fadeOutGraphic=this.add.graphics(0,0),this.fadeOutGraphic.clear(),this.fadeOutGraphic.beginFill(0,1),this.fadeOutGraphic.alpha=.8,this.fadeOutGraphic.drawRect(0,0,this.game.width,this.game.height),this.fadeOutGraphic.endFill(),this.fadeOutGraphic.visible=!1,this.returnToSelect=game.add.button(game.world.centerX,160,"buttons",this.returnToLevelSelect,this,void 0,"buttons_levelselect_up","buttons_levelselect_down"),this.returnToSelect.anchor={x:.5,y:.5},this.returnToSelect.scale.setTo(.4,.4);var t=function(){BnB.AudioManager.toggleMusic(),BnB.AudioManager.playSFX("select"),this.toggleMusicButton.frameName="buttons_toggleA_up"===this.toggleMusicButton.frameName?"buttons_toggleA_down":"buttons_toggleA_up"},i=function(){BnB.AudioManager.toggleSFX(),BnB.AudioManager.playSFX("select"),this.toggleSFXButton.frameName="buttons_toggleB_up"===this.toggleSFXButton.frameName?"buttons_toggleB_down":"buttons_toggleB_up"};this.toggleMusicText=this.add.text(game.world.centerX-90,280,"Music:",e),this.toggleMusicText.anchor={x:.5,y:.5},this.toggleMusicText.inputEnabled=!0,this.toggleMusicText.events.onInputDown.add(t,this),this.toggleMusicButton=game.add.button(game.world.centerX-90,360,"buttons",t,this),this.toggleMusicButton.anchor={x:.5,y:.5},this.toggleMusicButton.frameName="buttons_toggleA_up",this.toggleMusicButton.scale.setTo(.4,.4),this.toggleSFXText=this.add.text(game.world.centerX+90,280,"SFX:",e),this.toggleSFXText.anchor={x:.5,y:.5},this.toggleSFXText.inputEnabled=!0,this.toggleSFXText.events.onInputDown.add(i,this),this.toggleSFXButton=game.add.button(game.world.centerX+90,360,"buttons",i,this),this.toggleSFXButton.anchor={x:.5,y:.5},this.toggleSFXButton.frameName="buttons_toggleB_up",this.toggleSFXButton.scale.setTo(.4,.4),this.toggleGroup=this.add.group(),this.toggleGroup.add(this.toggleMusicText),this.toggleGroup.add(this.toggleMusicButton),this.toggleGroup.add(this.toggleSFXText),this.toggleGroup.add(this.toggleSFXButton),this.toggleGroup.add(this.returnToSelect),this.toggleGroup.visible=!1;var a=480;this.creditsGroup=this.add.group();var s=this.add.text(game.world.centerX,a,"CREDITS:",e),n=this.add.text(game.world.centerX,a+60,"Rohit Crasta",e),r=this.add.text(game.world.centerX,a+100,"David Wallin",e),o=this.add.text(game.world.centerX,a+140,"Michael Hoffman",e);s.anchor={x:.5,y:.5},n.anchor={x:.5,y:.5},r.anchor={x:.5,y:.5},o.anchor={x:.5,y:.5},this.creditsGroup.add(s),this.creditsGroup.add(n),this.creditsGroup.add(r),this.creditsGroup.add(o),this.creditsGroup.visible=!1,this.continueButton=game.add.button(game.world.centerX,720,"buttons",this.hideSettings,this,"buttons_resume_up","buttons_resume_up","buttons_resume_down","buttons_resume_up"),this.continueButton.anchor={x:.5,y:.5},this.continueButton.scale.setTo(.4,.4),this.continueButton.visible=!1},enableBuilderMode:function(){this.levelText.visible=!1,this.starsHUD.visible=!1,this.stopButton=this.add.image(0,0,"stopButton"),this.stopButton.scale.setTo(.1,.1),this.stopButton.inputEnabled=!0,this.stopButton.events.onInputDown.add(function(){this.state.start("LevelBuilder")},this)},update:function(){this.graphicsManager.refresh(),"ready"==this.inputManager.state||("swiping"===this.inputManager.state?this.doSwipingOffset():"moving"===this.inputManager.state?this.startMoving():"waiting"===this.inputManager.state&&this.graphicsManager.areAnimationsFinished()&&this.tutorialFinished&&!this.levelFinished&&this.finishMoving())},doSwipingOffset:function(){var e=this.inputManager.getSwipingOffset(),t=BnB.Util.getDirection(e);"left"===t||"right"===t?(BnB.C.SWIPING_OFFSET&&this.graphicsManager.setActiveOffset(t,e.x),BnB.C.SWIPING_LEANING&&this.graphicsManager.setLeaning(t,e.x)):("up"===t||"down"===t)&&(BnB.C.SWIPING_OFFSET&&this.graphicsManager.setActiveOffset(t,e.y),BnB.C.SWIPING_LEANING&&this.graphicsManager.setLeaning(t,e.y))},startMoving:function(){this.results=this.gameLogic.gravitySwitch(this.inputManager.direction),console.log(this.results),this.graphicsManager.updateGraphics(this.results),this.settingsButton.inputEnabled=!1,this.inputManager.state="waiting"},finishMoving:function(){this.results.moveSuccess&&this.onMoveComplete(),this.checkEndState()||(this.settingsButton.alpha=1,this.settingsButton.inputEnabled=!0,this.inputManager.state="ready")},onMoveComplete:function(){BnB.AudioManager.playSFX("thunk"),this.numMoves<99&&this.numMoves++,this.updateHUD()},checkEndState:function(){return"none"!=this.results.endState&&"missionSuccess"!=this.results.endState?(BnB.AudioManager.playSFX(this.results.endState),this.restartLevel(),!0):"missionSuccess"===this.results.endState?(this.loadVictory(),!0):!1},updateHUD:function(){this.currentStarLevel>0&&(this.moveText.text="Moves: "+this.numMoves),3==this.currentStarLevel&&this.numMoves>this.starLevels[1]?(this.currentStarLevel=2,this.updateStars(2)):2==this.currentStarLevel&&this.numMoves>this.starLevels[0]&&(this.currentStarLevel=1,this.updateStars(1))},updateStars:function(e){if(0!=BnB.SaveData.getStars(this.level)||!BnB.C.HIDE_STARS){this.starsHUD.removeAll();var t=350,i=30;if(3==e?(this.createStar(t-13,i-10),this.createStar(t+13,i-10),this.createStar(t,i+10)):2==e?(this.createStar(t-10,i),this.createStar(t+15,i)):1==e&&this.createStar(t,i),e>1){var a=this.add.text(t+30,i-15," = "+this.starLevels[e-2],{font:"25px Quicksand",fontSize:25,fill:"#ffffff",align:"left"});this.starsHUD.add(a)}}},createStar:function(e,t){var i=this.add.image(e,t,"star");i.anchor={x:.5,y:.5},i.scale.setTo(.5,.5),this.starsHUD.add(i)},startTutorial:function(){this.fadeOutGraphic.visible=!0,this.tutorialImage=this.add.sprite(this.game.width/2,this.game.height/2,this.levelData.tutorial[this.currentTutorial]),this.tutorialImage.anchor={x:.5,y:.5},this.tutorialImage.scale.multiply(BnB.scale,BnB.scale),game.input.onTap.add(this.nextTutorial,this),game.input.keyboard.addCallbacks(this,null,this.nextTutorial)},nextTutorial:function(){this.tutorialFinished||(BnB.AudioManager.playSFX("next-slide"),this.currentTutorial+=1,this.tutorialImage.destroy(),this.currentTutorial===this.levelData.tutorial.length?(this.fadeOutGraphic.visible=!1,this.tutorialFinished=!0,this.inputManager.state="ready"):(this.tutorialImage=this.add.sprite(this.game.width/2,this.game.height/2,this.levelData.tutorial[this.currentTutorial]),this.tutorialImage.anchor={x:.5,y:.5},this.tutorialImage.scale.multiply(BnB.scale,BnB.scale)))},loadVictory:function(){if(this.tutorialFinished){BnB.AudioManager.fadeMusicTo(200,BnB.C.VOLUME_FINISH),this.levelFinished=!0,this.inputManager.state="finished",this.currentStarLevel>BnB.SaveData.getStars(this.level)&&BnB.SaveData.setStars(this.level,this.currentStarLevel),this.level+1<BnB.SaveData.getNumLevels()&&-1==BnB.SaveData.getStars(this.level+1)&&BnB.SaveData.setStars(this.level+1,0),this.fadeOutGraphic.visible=!0,this.add.text(this.game.width/2.5,.6*this.game.height,this.numMoves+" moves",{font:"100px Quicksand",fontSize:25,fill:"#ffffff",align:"left"});var e=this.add.sprite(this.game.width/2,this.game.height/3,"starFinish","stars0001");e.anchor={x:.5,y:.5},1==this.currentStarLevel?(BnB.AudioManager.playSFX("star1"),e.animations.add("finish",Phaser.Animation.generateFrameNames("stars",0,11,"",4),24,!1,!1)):2==this.currentStarLevel?(BnB.AudioManager.playSFX("star2"),e.animations.add("finish",Phaser.Animation.generateFrameNames("stars",0,23,"",4),24,!1,!1)):(BnB.AudioManager.playSFX("star3"),e.animations.add("finish",Phaser.Animation.generateFrameNames("stars",0,35,"",4),24,!1,!1)),e.animations.play("finish"),this.newGroup=this.add.group();var t=.4,i=50,a=.6*this.game.height,s=i+130,n={font:"25px Quicksand",fontSize:25,fill:"#ffffff",align:"left"},r=BnB.SaveData.getStars(this.level),o=this.add.image(i,a,"star3");if(o.scale.setTo(t),this.add.text(i+50,a+15," = "+this.starLevels[1],n),3==r){var h=this.add.image(s,a+20,"checkMark");h.anchor.setTo(.5),h.scale.setTo(.2)}a+=60;var o=this.add.image(i,a,"star2");if(o.scale.setTo(t),this.add.text(i+50,a+15," = "+this.starLevels[0],n),r>=2){var h=this.add.image(s,a+20,"checkMark");h.anchor.setTo(.5),h.scale.setTo(.2)}a+=60;var o=this.add.image(i,a,"star1");o.scale.setTo(t);var h=this.add.image(s-50,a+20,"checkMark");h.anchor.setTo(.5),h.scale.setTo(.2),this.restartButtonBig.alpha=1,this.restartButtonBig.x=game.width/6*2,this.restartButtonBig.y=.9*this.game.height,this.newGroup.add(this.restartButtonBig),this.playButton=this.add.image(game.width/6*4,.9*this.game.height,"pButton"),this.playButton.anchor={x:.5,y:.5},this.playButton.scale.setTo(2.5,2.5),this.playButton.inputEnabled=!0,this.playButton.events.onInputDown.add(this.nextLevel,this),this.newGroup.add(this.playButton)}},showSettings:function(){this.inputManager.state="none",BnB.AudioManager.playSFX("select"),BnB.AudioManager.fadeMusicTo(200,BnB.C.VOLUME_SETTINGS),this.fadeOutGraphic.visible=!0,this.continueButton.visible=!0,this.creditsGroup.visible=!0,this.toggleGroup.visible=!0},hideSettings:function(){this.inputManager.state="ready",BnB.AudioManager.playSFX("select"),BnB.AudioManager.restoreMusic(),this.fadeOutGraphic.visible=!1,this.continueButton.visible=!1,this.creditsGroup.visible=!1,this.toggleGroup.visible=!1},updateToggleStrings:function(){this.toggleMusicText.text=BnB.AudioManager.allowMusic?"Music: On":"Music: Off",this.toggleSFXText.text=BnB.AudioManager.allowSFX?"SFX: On":"SFX: Off"},nextLevel:function(){"builder"==BnB.levelType?this.state.start("LevelBuilder"):this.tutorialFinished&&(game.input.keyboard.addCallbacks(this,null,null),this.level+1===BnB.levels.length?this.state.start("Victory"):BnB.Util.goToLevel(this.level+1))},forceRestart:function(){BnB.AudioManager.playSFX("select"),this.restartLevel()},restartLevel:function(){this.tutorialFinished&&("normal"==BnB.levelType?BnB.Util.goToLevel(this.level):this.state.start("LevelBuilder"))},returnToLevelSelect:function(){if(this.tutorialFinished){BnB.AudioManager.playSFX("select");var e=Math.floor(this.level/BnB.C.LEVELS_PER_PAGE);this.state.start("LevelSelect",!0,!1,e*BnB.C.LEVELS_PER_PAGE)}},skipLevel:function(){this.numMoves=0,this.levelFinished||BnB.SaveData.setStars(this.level,0),this.level+1<BnB.SaveData.getNumLevels()&&-1==BnB.SaveData.getStars(this.level+1)&&BnB.SaveData.setStars(this.level+1,0),this.nextLevel()},previousLevel:function(){this.level-1<0||(this.numMoves=0,this.levelFinished||BnB.SaveData.setStars(this.level,0),BnB.Util.goToLevel(this.level-1))},printMap:function(){var e="{\n";e+='"name": "Exported Level",\n',e+='"width": '+this.levelData.height+",\n",e+='"height": '+this.levelData.width+",\n";for(var t='"active": [\n',i=0;i<this.levelData.width;i++){t+="[";for(var a=0;a<this.levelData.height;a++){var s=this.levelData.active[a][i];t+='"'+s+'"',a<this.levelData.height-1&&(t+=",")}t+=i<this.levelData.width-1?"],\n":"]\n"}t+="],\n";for(var n='"fixed": [\n',i=0;i<this.levelData.width;i++){n+="[";for(var a=0;a<this.levelData.height;a++){var s=this.levelData.fixed[a][i];n+='"'+s+'"',a<this.levelData.height-1&&(n+=",")}n+=i<this.levelData.width-1?"],\n":"]\n"}n+="]\n",console.log(e+"\n"+t+"\n"+n+"\n}")}};var activeKeyChar={brainy:"b",brawny:"B",moveable:"@",spikey:"$",alienRoller:"m"},fixedKeyChar={block:"#",alien:"E",goalBrainy:"g",goalBrawny:"G",pipe0:"0",spikedBlock:"X",breakable:"+",empty:"n",switchNew1A:"1",switchNew2A:"5",switchNew3A:"9",switchNew4A:"13",gateNew1C:"3",gateNew2C:"7",gateNew3C:"11",gateNew4C:"15",coloredPeg1:"17",coloredPeg2:"18",coloredPeg3:"19",coloredPeg4:"20"},bigKeyLookup={b:"brainy",B:"brawny","@":"moveable",$:"spikey","#":"block",E:"alien",g:"goalBrainy",G:"goalBrawny",0:"pipe0",X:"spikedBlock","+":"breakable",m:"alienRoller",n:"empty",1:"switchNew1A",5:"switchNew2A",9:"switchNew3A",13:"switchNew4A",3:"gateNew1C",7:"gateNew2C",11:"gateNew3C",15:"gateNew4C",17:"coloredPeg1",18:"coloredPeg2",19:"coloredPeg3",20:"coloredPeg4"};BnB.LevelBuilder=function(){BnB.SaveData.workingLevel.saved=!1,this.passingData},BnB.LevelBuilder.prototype={init:function(){BnB.C.BOUNDS_DEATH=!1,this.brushWidth=BnB.C.WIDTH/11,this.brushHeight=this.brushWidth,this.gridWidth=BnB.levelBuilderX,this.gridHeight=BnB.levelBuilderY;var e=3.2*this.brushHeight;50*this.gridWidth>=62.5*this.gridHeight?(this.cellWidth=BnB.C.WIDTH/this.gridWidth,this.cellHeight=this.cellWidth/50*62.5):(this.cellHeight=(BnB.C.HEIGHT-e)/this.gridHeight,this.cellWidth=this.cellHeight/62.5*50);var t=(BnB.C.WIDTH-this.gridWidth*this.cellWidth)/2;this.playArea={x:t,y:e,w:this.cellWidth*this.gridWidth,h:this.cellHeight*this.gridHeight},this.brushes,this.currentBrush="brainy",this.brushDisplay,this.gridImages,this.eraserOn=!1},create:function(){BnB.levelType="builder",this.state.add("AdjustMenu",BnB.AdjustMenu),this.graphics=this.add.graphics(0,0),this.graphics.lineStyle(2,14540253,.5);for(var e=0;e<=this.gridHeight;e++)this.graphics.moveTo(this.playArea.x,this.playArea.y+e*this.cellHeight),this.graphics.lineTo(this.playArea.x+this.playArea.w,this.playArea.y+e*this.cellHeight);for(var e=0;e<=this.gridWidth;e++)this.graphics.moveTo(this.playArea.x+e*this.cellWidth,this.playArea.y),this.graphics.lineTo(this.playArea.x+e*this.cellWidth,this.playArea.y+this.playArea.h);if(this.brushes=this.add.group(),this.createBrushPalette(),this.gridImages=this.add.group(),BnB.SaveData.workingLevel.saved){for(var e=0;e<this.gridHeight;e++)if(e>=BnB.SaveData.workingLevel.height)for(var t=0;t<this.gridWidth;t++){var i=this.gridImages.create(this.playArea.x+t*this.cellWidth,this.playArea.y+e*this.cellHeight,"floor");i.width=this.cellWidth,i.height=this.cellHeight,i.visible=!1}else for(var t=0;t<this.gridWidth;t++){var i,a=BnB.SaveData.workingLevel.fixed[e][t],s=BnB.SaveData.workingLevel.active[e][t];a in bigKeyLookup?(i=this.gridImages.create(this.playArea.x+t*this.cellWidth,this.playArea.y+e*this.cellHeight,bigKeyLookup[a]),i.visible=!0):s in bigKeyLookup?(i=this.gridImages.create(this.playArea.x+t*this.cellWidth,this.playArea.y+e*this.cellHeight,bigKeyLookup[s]),i.visible=!0):(i=this.gridImages.create(this.playArea.x+t*this.cellWidth,this.playArea.y+e*this.cellHeight,"floor"),i.visible=!1),i.width=this.cellWidth,i.height=this.cellHeight}this.printMap()}else for(var e=0;e<this.gridHeight;e++)for(var t=0;t<this.gridWidth;t++){var i=this.gridImages.create(this.playArea.x+t*this.cellWidth,this.playArea.y+e*this.cellHeight,"floor");i.width=this.cellWidth,i.height=this.cellHeight,i.visible=!1}game.input.onTap.add(function(){this.useBrush()},this)},update:function(){},createBrushPalette:function(){this.brushDisplay=this.add.image(2,2,"brainy"),this.brushDisplay.width=this.brushWidth,this.brushDisplay.height=this.brushHeight,this.graphics.lineStyle(3,65535,1),this.graphics.drawRect(0,0,this.brushWidth+4,this.brushHeight+4),this.brushes.create(0,0,"brainy"),this.brushes.create(0,0,"brawny"),this.brushes.create(0,0,"goalBrainy"),this.brushes.create(0,0,"goalBrawny"),this.brushes.create(0,0,"switchNew1A"),this.brushes.create(0,0,"switchNew2A"),this.brushes.create(0,0,"switchNew3A"),this.brushes.create(0,0,"switchNew4A"),this.brushes.create(0,0,"empty"),this.brushes.create(0,0,"block"),this.brushes.create(0,0,"pipe0"),this.brushes.create(0,0,"breakable"),this.brushes.create(0,0,"moveable"),this.brushes.create(0,0,"gateNew1C"),this.brushes.create(0,0,"gateNew2C"),this.brushes.create(0,0,"gateNew3C"),this.brushes.create(0,0,"gateNew4C"),this.brushes.create(0,0,"empty"),this.brushes.create(0,0,"alien"),this.brushes.create(0,0,"alienRoller"),this.brushes.create(0,0,"spikedBlock"),this.brushes.create(0,0,"spikey"),this.brushes.create(0,0,"coloredPeg1"),this.brushes.create(0,0,"coloredPeg2"),this.brushes.create(0,0,"coloredPeg3"),this.brushes.create(0,0,"coloredPeg4");for(var e=0;e<this.brushes.length;e++){var t=this.brushes.getAt(e);console.log("I was here!"),t.inputEnabled=!0,t.events.onInputDown.add(this.selectBrush,this),t.width=this.brushWidth,t.height=this.brushHeight}for(var i=this.brushWidth,a=9,s=0,e=0;e<this.brushes.length;e++){var n=e%a;0==n&&0!=e&&s++,this.brushes.getAt(e).x=n*this.brushWidth+i,this.brushes.getAt(e).y=s*this.brushHeight}return this.playButton=this.add.image(0,1.1*this.brushHeight,"playButton"),this.playButton.width=this.brushWidth,this.playButton.height=this.brushHeight,this.playButton.inputEnabled=!0,this.playButton.events.onInputDown.add(this.playLevel,this),this.eraseButton=this.add.image(0,2.1*this.brushHeight,"eraser"),this.eraseButton.width=this.brushWidth,this.eraseButton.height=this.brushHeight,this.eraseButton.inputEnabled=!0,this.eraseButton.events.onInputDown.add(this.toggleEraser,this),this.saveButton=this.add.image(BnB.C.WIDTH-this.brushWidth,0,"saveIcon"),this.saveButton.width=this.brushWidth,this.saveButton.height=this.brushHeight,this.saveButton.inputEnabled=!0,this.saveButton.events.onInputDown.add(this.saveLevel,this),this.flipButton=this.add.image(BnB.C.WIDTH-this.brushWidth,this.brushHeight,"flipIcon"),this.flipButton.width=this.brushWidth,this.flipButton.height=this.brushHeight,this.flipButton.inputEnabled=!0,this.flipButton.events.onInputDown.add(this.flipLevel,this),this.flipVertButton=this.add.image(BnB.C.WIDTH-this.brushWidth,2*this.brushHeight,"flipVertIcon"),this.flipVertButton.width=this.brushWidth,this.flipVertButton.height=this.brushHeight,this.flipVertButton.inputEnabled=!0,this.flipVertButton.events.onInputDown.add(this.flipLevelVertically,this),this.sizeButton=this.add.image(BnB.C.WIDTH-2*this.brushWidth,2*this.brushHeight,"dimensions"),this.sizeButton.width=this.brushWidth,this.sizeButton.height=this.brushHeight,this.sizeButton.inputEnabled=!0,this.sizeButton.events.onInputDown.add(this.changeDimensions,this),3*this.brushHeight},selectBrush:function(e){this.currentBrush=e.key,console.log("selected brush: "+this.currentBrush),this.eraserOn=!1,this.brushDisplay.loadTexture(this.currentBrush),this.brushDisplay.visible=!0},useBrush:function(){var e=game.input.x,t=game.input.y;if(e>=this.playArea.x&&e<=this.playArea.x+this.playArea.w&&t>=this.playArea.y&&t<=this.playArea.y+this.playArea.h){var i=this.screenToGridCoordinates(e,t);this.drawBrushImage(i.x,i.y)}game.input.keyboard.isDown(Phaser.Keyboard.P)},drawBrushImage:function(e,t){game.input.keyboard.isDown(Phaser.Keyboard.E)||this.eraserOn?(this.gridImages.getAt(t*this.gridWidth+e).visible=!1,this.gridImages.getAt(t*this.gridWidth+e).loadTexture("floor")):(this.gridImages.getAt(t*this.gridWidth+e).visible=!0,this.gridImages.getAt(t*this.gridWidth+e).loadTexture(this.currentBrush))},screenToGridCoordinates:function(e,t){if(e>=this.playArea.x&&e<=this.playArea.x+this.playArea.w&&t>=this.playArea.y&&t<=this.playArea.y+this.playArea.h){var i=e-this.playArea.x,a=t-this.playArea.y;cellX=0;for(var s=0;s<=this.gridWidth;s++)i>s*this.cellWidth&&(cellX=s);for(var s=0;s<=this.gridHeight;s++)a>s*this.cellHeight&&(cellY=s);return console.log("cell: ("+cellX+","+cellY+")"),{x:cellX,y:cellY}}console.log("something went wrong!")},printMap:function(){BnB.levelBuilderX=this.gridWidth,BnB.levelBuilderY=this.gridHeight,BnB.SaveData.workingLevel.height=this.gridHeight,BnB.SaveData.workingLevel.width=this.gridWidth,BnB.SaveData.workingLevel.active=[],BnB.SaveData.workingLevel.fixed=[],("undefined"==typeof BnB.SaveData.workingLevel.starLevels||3!=BnB.SaveData.workingLevel.starLevels.length)&&(BnB.SaveData.workingLevel.starLevels=[99,99]),"undefined"==typeof BnB.SaveData.workingLevel.name&&(BnB.SaveData.workingLevel.name="test");var e="{\n";e+='"name": "Exported Level",\n',e+='"width": '+this.gridWidth+",\n",e+='"height": '+this.gridHeight+",\n";for(var t='"active": [\n',i=0;i<this.gridHeight;i++){t+="[",BnB.SaveData.workingLevel.active.push([]);for(var a=0;a<this.gridWidth;a++){var s=this.gridImages.getAt(i*this.gridWidth+a).key,n=" ";s in activeKeyChar&&(n=activeKeyChar[s]),t+='"'+n+'"',a<this.gridWidth-1&&(t+=","),BnB.SaveData.workingLevel.active[i].push(n)}t+=i<this.gridHeight-1?"],\n":"]\n"}t+="],\n";for(var r='"fixed": [\n',i=0;i<this.gridHeight;i++){r+="[",BnB.SaveData.workingLevel.fixed.push([]);for(var a=0;a<this.gridWidth;a++){var s=this.gridImages.getAt(i*this.gridWidth+a).key,n=" ";s in fixedKeyChar&&(n=fixedKeyChar[s]),r+='"'+n+'"',a<this.gridWidth-1&&(r+=","),BnB.SaveData.workingLevel.fixed[i].push(n)}r+=i<this.gridHeight-1?"],\n":"]\n"}r+="]\n",console.log(e+"\n"+t+"\n"+r+"\n}"),this.passingData=Phaser.Utils.extend(!0,BnB.SaveData.workingLevel),BnB.SaveData.workingLevel.saved=!0},changeDimensions:function(){this.printMap(),this.state.start("AdjustMenu")},toggleEraser:function(){this.eraserOn=!0,this.brushDisplay.visible=!1},saveLevel:function(){this.printMap();var e=BnB.SaveData.workingLevel,t=JSON.stringify(e),i=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(i),s=window.open("","_blank");s.document.write('<a href="'+a+'" download="my_level.json">DOWNLOAD</a>')},flipLevel:function(){for(var e=[],t=0;t<this.gridWidth;t++)for(var i=0;i<this.gridHeight;i++)e.push(this.gridImages.getAt(i*this.gridWidth+t).key);var a=this.gridHeight,s=this.gridWidth;this.gridHeight=s,this.gridWidth=a,this.gridImages.removeAll(!0);for(var t=0;s>t;t++)for(var i=0;a>i;i++){var n=e[t*a+i];this.gridImages.create(0,0,n)}this.printMap(),game.state.start("LevelBuilder")},flipLevelVertically:function(){for(var e=this.gridWidth,t=this.gridHeight,i=[],a=this.gridHeight-1;a>=0;a--)for(var s=0;s<this.gridWidth;s++)i.push(this.gridImages.getAt(a*this.gridWidth+s).key);this.gridImages.removeAll(!0);for(var a=0;t>a;a++)for(var s=0;e>s;s++){var n=i[a*e+s];this.gridImages.create(0,0,n)}this.printMap(),game.state.start("LevelBuilder")},playLevel:function(){this.printMap(),BnB.Util.goToCustomLevel(0,this.passingData)}},BnB.LevelSelect=function(){},BnB.LevelSelect.prototype={init:function(e){this.numSections=12,this.numLevels=BnB.levels.length-e,this.startingID=e,this.numLevels>BnB.C.LEVELS_PER_PAGE&&(this.numLevels=BnB.C.LEVELS_PER_PAGE)},create:function(){BnB.AudioManager.createAudioList(["select"]),this.bounds={x:0,y:BnB.C.HEIGHT-BnB.C.HEIGHT*this.numSections,width:this.game.width,height:BnB.C.HEIGHT*this.numSections},this.game.world.setBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height),this.starLayer=this.add.group(),this.initializeStars();for(var e=1;e<=this.numSections;e++){var t="";t=10>e?"0"+e:e;var i=-BnB.C.HEIGHT*this.numSections+BnB.C.HEIGHT*e,a=this.add.image(0,i,"levelmap"+t);a.width=this.game.width,a.height=BnB.C.HEIGHT}this.restartKey=game.input.keyboard.addKey(Phaser.Keyboard.R),this.restartKey.onUp.add(this.resetLevels,this),this.unlockKey=game.input.keyboard.addKey(Phaser.Keyboard.A),this.unlockKey.onUp.add(this.unlockLevels,this);var s={font:"30px Quicksand",fill:"#ffffff",align:"center"};if(this.unlockText=this.add.text(30,game.height-60,"Unlock All",s),this.unlockText.inputEnabled=!0,this.unlockText.events.onInputDown.add(this.unlockLevels,this),this.unlockText.fixedToCamera=!0,this.resetText=this.add.text(480,game.height-60,"Reset All",s),this.resetText.inputEnabled=!0,this.resetText.events.onInputDown.add(this.resetLevels,this),this.resetText.fixedToCamera=!0,0!=this.startingID){var n=this.add.image(10,10,"backArrow");n.scale.setTo(.4),n.inputEnabled=!0,n.events.onInputDown.add(this.onBack,this)}if(BnB.levels.length-this.startingID>BnB.C.LEVELS_PER_PAGE){var r=this.add.image(0,10,"forwardArrow");r.scale.setTo(.4),r.inputEnabled=!0,r.events.onInputDown.add(this.onForward,this),r.x=BnB.C.WIDTH-r.width}BnB.levelType="normal",BnB.C.BOUNDS_DEATH=!0,this.buttons=this.add.group(),this.buttonTexts=this.add.group();for(var i=.666*BnB.C.HEIGHT,o=128,e=0;e<this.numLevels;e++){var h=this.startingID+e;this.createButton(h,this.game.width/2,i-e*o)}this.game.kineticScrolling.start(),"TitleScreen"==BnB.fromState||"LevelSelect"==BnB.fromState?BnB.AudioManager.playMusic("menuMusic",!0):BnB.AudioManager.switchToMusic("menuMusic",!0),BnB.fromState="LevelSelect"},update:function(){this.updateStars()},shutdown:function(){this.game.kineticScrolling.stop()},createButton:function(e,t,i){var a=BnB.SaveData.getStars(e),s=["ui_level_lock","ui_level_unlock","ui_level_star1","ui_level_star2","ui_level_star3"],n=96,r=this.add.group();console.log(r);var o=this.add.image(t,i,"ui",s[a+1]);o.anchor={x:.5,y:.5},o.width=n,o.height=n,o.inputEnabled=!0,o.events.onInputUp.add(this.loadLevel,this),o.levelID=e;var h=this.add.text(t,i-12,e+1,{font:"48px Quicksand",fill:"#5C6466"});return h.anchor={x:.5,y:.5},r.add(o),r.add(h),r},loadLevel:function(e){BnB.AudioManager.playSFX("select"),BnB.SaveData.getStars(e.levelID)>=0&&(this.game.kineticScrolling.stop(),BnB.Util.goToLevel(e.levelID))},resetLevels:function(){BnB.AudioManager.playSFX("select"),BnB.SaveData.reset(),this.state.start("LevelSelect",!0,!1,0)},unlockLevels:function(){BnB.AudioManager.playSFX("select"),BnB.SaveData.unlockAll(),this.state.start("LevelSelect",!0,!1,this.startingID)},onBack:function(){var e=this.startingID-BnB.C.LEVELS_PER_PAGE;this.state.start("LevelSelect",!0,!1,e)},onForward:function(){var e=this.startingID+BnB.C.LEVELS_PER_PAGE;this.state.start("LevelSelect",!0,!1,e)},initializeStars:function(){this.spaceC=game.add.tileSprite(0,0,game.width,game.height,"spaceC"),this.spaceB=game.add.tileSprite(0,0,game.width,game.height,"spaceB"),this.spaceA=game.add.tileSprite(0,0,game.width,game.height,"spaceA"),this.spaceC.fixedToCamera=!0,this.spaceB.fixedToCamera=!0,this.spaceA.fixedToCamera=!0,this.starLayer.add(this.spaceC),this.starLayer.add(this.spaceB),this.starLayer.add(this.spaceA)},updateStars:function(){var e=BnB.Util.directionLookup.down;this.spaceC.tilePosition.x+=e.x,this.spaceC.tilePosition.y+=e.y,this.spaceB.tilePosition.x+=2*e.x,this.spaceB.tilePosition.y+=2*e.y,this.spaceA.tilePosition.x+=4*e.x,this.spaceA.tilePosition.y+=4*e.y}},BnB.MainMenu=function(){},BnB.MainMenu.prototype={create:function(){var e=["Play","Builder"],t={font:"50px Quicksand",fill:"#ffffff",align:"center"},i=BnB.Util.createMenu(e,t);i.getChildAt(0).events.onInputDown.add(this.onPlay,this),i.getChildAt(1).events.onInputDown.add(this.onLevel,this)},onPlay:function(){BnB.AudioManager.playSFX("select"),this.state.start("LevelSelect",!0,!1,0)},onLevel:function(){this.state.start("LevelBuilder")}},BnB.Preloader=function(){},BnB.Preloader.prototype={init:function(){this.loadingBar=this.add.image(this.world.centerX,this.world.centerY,"loadingBar"),this.loadingBar.x=this.world.centerX-this.loadingBar.width/2,this.loadingBar.anchor.y=.5,this.loadingBack=this.add.image(this.world.centerX-this.loadingBar.width/2,this.world.centerY,"loadingBack"),this.loadingBack.anchor.y=.5},preload:function(){this.load.atlasJSONArray("spritesheet","images/spritesheet.png","images/spritesheet.json"),this.load.atlasJSONArray("brainy_SpriteSheet","images/Brainy_SpriteSheet.png","images/Brainy_SpriteSheet.json"),this.load.atlasJSONArray("brawny_SpriteSheet","images/Brawny_SpriteSheet.png","images/Brawny_SpriteSheet.json"),this.load.atlasJSONArray("block_SpriteSheet","images/seamlessWalls.png","images/seamlessWalls.json"),this.load.atlasJSONArray("starFinish","images/stars.png","images/stars.json"),this.load.atlasJSONArray("buttons","images/buttons.png","images/buttons.json"),this.load.atlasJSONArray("ui","images/ui.png","images/ui.json"),this.load.image("backArrow","images/back-arrow.png"),this.load.image("forwardArrow","images/forward-arrow.png"),this.load.image("arrow","images/arrow.png"),this.load.image("dimensions","images/dimensions.png"),this.load.image("saveIcon","images/saveButton.png"),this.load.image("flipIcon","images/flipButton.png"),this.load.image("flipVertIcon","images/flipButtonVert.png"),this.load.image("settingsButton","images/settingsButton.png"),this.load.image("levelmap01","images/levelmap/levelmap-01.png"),this.load.image("levelmap02","images/levelmap/levelmap-02.png"),this.load.image("levelmap03","images/levelmap/levelmap-03.png"),this.load.image("levelmap04","images/levelmap/levelmap-04.png"),this.load.image("levelmap05","images/levelmap/levelmap-05.png"),this.load.image("levelmap06","images/levelmap/levelmap-06.png"),this.load.image("levelmap07","images/levelmap/levelmap-07.png"),this.load.image("levelmap08","images/levelmap/levelmap-08.png"),this.load.image("levelmap09","images/levelmap/levelmap-09.png"),this.load.image("levelmap10","images/levelmap/levelmap-10.png"),this.load.image("levelmap11","images/levelmap/levelmap-11.png"),this.load.image("levelmap12","images/levelmap/levelmap-12.png"),this.load.image("tutorial1","images/tutorials-01.png"),this.load.image("tutorial2","images/tutorials-02.png"),this.load.image("tutorial3","images/tutorials-03.png"),this.load.image("tutorial4","images/tutorials-04.png"),this.load.image("tutorial5","images/tutorials-05.png"),this.load.image("tutorial6","images/tutorials-06.png"),this.load.image("tutorial7","images/tutorials-07.png"),this.load.image("tutorial8","images/tutorials-08.png"),this.load.image("tutorial9","images/tutorials-09.png"),this.load.image("spaceA","images/space_A.png"),this.load.image("spaceB","images/space_B.png"),this.load.image("spaceC","images/space_C.png"),this.load.image("imageHUD","images/HUD-04.png"),this.load.image("rButton","images/restart-button.png"),this.load.image("pButton","images/play-button.png"),this.load.image("mButton","images/menu-button-02.png"),this.load.image("imageTitle","images/titlescreen-03.png"),this.load.image("victory","images/missionSuccess.png"),this.load.image("star","images/star.png"),this.load.image("star1","images/star1.png"),this.load.image("star2","images/star2.png"),this.load.image("star3","images/star3.png"),this.load.image("checkMark","images/greencheck.png"),BnB.AudioManager.preload(this),this.load.image("floor","images/spritesheet/brainandbrawn_floor.png"),this.load.image("brainy","images/spritesheet/brainandbrawn_brainy-b.png"),this.load.image("brawny","images/spritesheet/brainandbrawn_brawny-b.png"),this.load.image("block","images/spritesheet/brainandbrawn_block.png"),this.load.image("alien","images/spritesheet/brainandbrawn_alien-b.png"),this.load.image("alienRoller","images/spritesheet/brainandbrawn_alien4.png"),this.load.image("goalBrainy","images/spritesheet/brainandbrawn_goalBrainy.png"),this.load.image("goalBrawny","images/spritesheet/brainandbrawn_goalBrawny.png"),this.load.image("moveable","images/spritesheet/brainandbrawn_slidingBlock.png"),this.load.image("pipe0","images/spritesheet/brainandbrawn_pipe0.png"),this.load.image("spikedBlock","images/spritesheet/brainandbrawn_alien2.png"),this.load.image("switchNew1A","images/spritesheet/brainandbrawn_switchNew1A.png"),this.load.image("switchNew1B","images/spritesheet/brainandbrawn_switchNew1B.png"),this.load.image("switchNew2A","images/spritesheet/brainandbrawn_switchNew2A.png"),this.load.image("switchNew2B","images/spritesheet/brainandbrawn_switchNew2B.png"),this.load.image("switchNew3A","images/spritesheet/brainandbrawn_switchNew3A.png"),this.load.image("switchNew3B","images/spritesheet/brainandbrawn_switchNew3B.png"),this.load.image("switchNew4A","images/spritesheet/brainandbrawn_switchNew4A.png"),this.load.image("switchNew4B","images/spritesheet/brainandbrawn_switchNew4B.png"),this.load.image("gateNew1C","images/spritesheet/brainandbrawn_gateNew1C.png"),this.load.image("gateNew1D","images/spritesheet/brainandbrawn_gateNew1D.png"),this.load.image("gateNew2C","images/spritesheet/brainandbrawn_gateNew2C.png"),this.load.image("gateNew2D","images/spritesheet/brainandbrawn_gateNew2D.png"),this.load.image("gateNew3C","images/spritesheet/brainandbrawn_gateNew3C.png"),this.load.image("gateNew3D","images/spritesheet/brainandbrawn_gateNew3D.png"),this.load.image("gateNew4C","images/spritesheet/brainandbrawn_gateNew4C.png"),this.load.image("gateNew4D","images/spritesheet/brainandbrawn_gateNew4D.png"),this.load.image("spikey","images/spritesheet/brainandbrawn_alien3.png"),this.load.image("breakable","images/spritesheet/brainandbrawn_wallDamaged.png"),this.load.image("coloredPeg1","images/spritesheet/brainandbrawn_peg1.png"),this.load.image("coloredPeg2","images/spritesheet/brainandbrawn_peg2.png"),this.load.image("coloredPeg3","images/spritesheet/brainandbrawn_peg3.png"),this.load.image("coloredPeg4","images/spritesheet/brainandbrawn_peg4.png"),this.load.image("playButton","images/playButton.png"),this.load.image("stopButton","images/stopButton.png"),this.load.image("eraser","images/eraserTool.png"),this.load.image("empty","images/cancel.png"),BnB.levels.forEach(function(e,t){this.load.text("level"+t,e)
},this),this.load.onFileComplete.add(this.fileLoaded,this)},fileLoaded:function(e){this.loadingBar.scale.setTo(e/100,1)},create:function(){this.state.start("TitleScreen")}},BnB.TitleScreen=function(){},BnB.TitleScreen.prototype={create:function(){BnB.AudioManager.createAudioList(["ambience1","select"]);var e=this.add.sprite(this.game.width/2,this.game.height/2,"imageTitle");e.anchor={x:.5,y:.5},e.scale.multiply(BnB.C.WIDTH/e.width,BnB.C.HEIGHT/e.height),game.add.sprite(game.width,game.height,"brawny_SpriteSheet"),game.add.sprite(game.width,game.height,"brainy_SpriteSheet"),this.add.text(game.width,game.height,"text",{font:"12px Quicksand"}),this.input.onTap.add(this.startGame,this),BnB.AudioManager.playMusic("ambience1",!0)},startGame:function(){BnB.AudioManager.playSFX("menu-start"),"test"==BnB.buildType?this.state.start("MainMenu"):this.state.start("LevelSelect",!0,!1,0)}},BnB.Victory=function(){},BnB.Victory.prototype={create:function(){var e=this.add.sprite(BnB.C.WIDTH/2,BnB.C.HEIGHT/2,"victory");e.anchor={x:.5,y:.5},e.scale.multiply(BnB.C.WIDTH/e.width,BnB.C.HEIGHT/e.height),this.input.onTap.add(this.onReturn,this)},onReturn:function(){this.state.start("LevelSelect",!0,!1,0)}};var ratio=window.innerHeight/window.innerWidth,height=BnB.C.WIDTH*ratio>BnB.C.HEIGHT?BnB.C.WIDTH*ratio:BnB.C.HEIGHT,game=new Phaser.Game(BnB.C.WIDTH,height);game.state.add("Boot",BnB.Boot),game.state.add("Preloader",BnB.Preloader),game.state.add("TitleScreen",BnB.TitleScreen),game.state.add("Victory",BnB.Victory),game.state.add("MainMenu",BnB.MainMenu),game.state.add("LevelSelect",BnB.LevelSelect),game.state.add("LevelBuilder",BnB.LevelBuilder),game.state.add("Level",BnB.Level),game.state.start("Boot");